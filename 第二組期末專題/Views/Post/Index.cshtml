
@{
    ViewBag.Title = "article";
}

@section HtmlHeadEnd{
    <link rel="stylesheet" href="~/Content/css/post.css" />
    <link rel="stylesheet" href="https://cdn.quilljs.com/1.3.6/quill.snow.css" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css">
}

@Html.Partial("貼文抬頭")

@Html.Partial("編輯區域")

@Html.Partial("~/Views/Shared/登入了嗎.cshtml")

@section HtmlBodyEnd{
    <script src="https://kit.fontawesome.com/af1cff1fa5.js" crossorigin="anonymous"></script>
    <style type="text/css">
        button.ui-datepicker-trigger {
            border: none;
            margin-left: 0.5rem;
        }
    </style>

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="~/Content/js/jquery-3.6.0.min.js"></script>
    <script src="~/Content/js/jquery-ui.min.js"></script>
    <script src="~/Content/js/jquery.ui.datepicker-zh-TW.js"></script>


    <script type="text/javascript">
        $(function () {



            $("#pStartDate,#pEndDate").datepicker({
                dateFormat: 'yy/mm/dd',
                showOn: "both",
                buttonImage: "../Content/images/calendar.png",
                buttonText: "請挑選日期",
                changeYear: true,
                changeMonth: true
            });

            $("input[name=ppNumber]").spinner({
                max: 10, min: 1
            });

            // 預設照片
            var firstImg = "../Content/images/post_img_1_s.jpg";
            $(".preview").css("background-image", "url(" + firstImg + ")");

            // 照片更換
            $("#pUpload").change(function () {
                $(".preview").css("background-image", "url()");
                $("#preview .uploadImg").html("");
                previewImg(this.files);
            });

            function previewImg(files) {
                if (files.length == 0) {
                    return;
                }
                var file = files[0];
                var pic = new FileReader();

                pic.onload = function () {
                    var img = $("<img>").attr({ src: pic.result });
                    $("#preview .uploadImg ").html(img);
                };
                pic.readAsDataURL(file);
            }

            $(".pFormInput").focus(function () {
                $(this).css({ "border-color": "#56b4ef", "box-shadow": "0px 0px 3px 1px #c8def0" });
            });
            $(".pFormInput").blur(function () {
                $(this).css({ "border-color": "", "box-shadow": "" });
            });

            //標題
            var rule1 = /^.{3,20}$/;
            $("#pTitle").blur(function () {
                if (rule1.test($(this).val())) {
                    $('.errorMsg1').text('');
                    $(this).css({ "border-color": "#40E0D0", "box-shadow": "0px 0px 3px 1px #c8def0" });
                }
                else {
                    $('.errorMsg1').text('*請輸入至少3-5字標題*');
                    $(this).css({ "border-color": "#FA8072", "box-shadow": "0px 0px 3px 1px #c8def0" })
                }
            });

            //開始日期
            var rule2 = /^\d|..$/;
            $("#pStartDate").blur(function () {
                if (rule2.test($(this).val())) {
                    $('.errorMsg2').text('');
                    $(this).css({ "border-color": "#40E0D0", "box-shadow": "0px 0px 3px 1px #c8def0" });
                }
                else {
                    $('.errorMsg2').text('*請選擇開始日期*');
                    $(this).css({ "border-color": "#FA8072", "box-shadow": "0px 0px 3px 1px #c8def0" })
                }
            });

            //結束日期
            var rule3 = /^\d|..$/;
            $("#pEndDate").blur(function () {
                if (rule3.test($(this).val())) {
                    $('.errorMsg3').text('');
                    $(this).css({ "border-color": "#40E0D0", "box-shadow": "0px 0px 3px 1px #c8def0" });
                }
                else {
                    $('.errorMsg3').text('*請選擇結束日期*');
                    $(this).css({ "border-color": "#FA8072", "box-shadow": "0px 0px 3px 1px #c8def0" })
                }
            });

            //時段
            var rule4 = /^\d|..$/;
            $("#pTimezone").blur(function () {
                if (rule4.test($(this).val())) {
                    $('.errorMsg4').text('');
                    $(this).css({ "border-color": "#40E0D0", "box-shadow": "0px 0px 3px 1px #c8def0" });
                }
                else {
                    $('.errorMsg4').text('*請輸入完整的時段*');
                    $(this).css({ "border-color": "#FA8072", "box-shadow": "0px 0px 3px 1px #c8def0" })
                }
            });

            //接待人數
            $("input[name=ppNumber]").blur(function () {
                if ($(this).val() != '') {
                    $('.errorMsg5').text('');
                    $(this).css({ "border-color": "#40E0D0", "box-shadow": "0px 0px 3px 1px #c8def0" });
                }
                else {
                    $('.errorMsg5').text('*請選擇人數上限*');
                    $(this).css({ "border-color": "#FA8072", "box-shadow": "0px 0px 3px 1px #c8def0" })
                }
            })


        });
    </script>
    <script>

        //編輯器
        var Font = Quill.import('formats/font');
        Font.whiteList = ['mirza', 'roboto'];
        Quill.register(Font, true);

        var quill = new Quill('#editor-container', {
            modules: {
                toolbar: [
                    [{ header: [1, 2, false] }],
                    ['bold', 'italic'],
                    ['link', 'blockquote', 'code-block', 'image'],
                    [{ list: 'ordered' }, { list: 'bullet' }]
                ]
            },
            scrollingContainer: '#scrolling-container',
            placeholder: '開始分享您的旅程..',
            theme: 'snow'
        });


        var form = document.querySelector('form');

        $("#postSubmit").click(function () {
            // Populate hidden form on submit
            //var about = document.querySelector('input[name=about]');
            //about.value = JSON.stringify(quill.getContents());


            var content = JSON.stringify(quill.getContents());
            console.log("contents:", content);
            $("#pContent").val(content);


            $.ajax({
                type: 'Post',
                url: '../Post/New',
                data: $(form).serialize(),
                success: function () {
                    Swal.fire({
                        title: '確定要新增旅程嗎?',
                        showDenyButton: true,
                        showCancelButton: true,
                        confirmButtonText: '儲存',
                        denyButtonText: `再等一下`,
                    }).then((result) => {
                        /* Read more about isConfirmed, isDenied below */
                        if (result.isConfirmed) {
                            Swal.fire('新增成功!', '', 'success')
                        } else if (result.isDenied) {
                            Swal.fire('Changes are not saved', '', 'info')
                        }
                    })
                }
                //}).done(function (msg) {
                //    alert(msg);
            });

        });


    </script>
    <script src="~/Content/js/Hashtag群組.js"></script>
    <script>
        $(document).ready(function () {
            $.ajax({
                type: 'GET',
                url: '/Post/GetHashtags'
            }).done(function (hashtags) {
                new Hashtag群組(hashtags, { 編輯模式: true }).at('#Hashtag選擇區');
            });
        });
    </script>
}